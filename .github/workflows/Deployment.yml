name: Deployment

on: 
  push

jobs:
  build-and-test:
    runs-on: ubuntu-latest
  
    steps:
    - name: Setup Tailscale
      uses: tailscale/github-action@v2
      with:
        hostname: Github-actions
        oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
        oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}
        tags: tag:ci

    - name: Do the deploy thing
      run: |
        ssh -o "StrictHostKeyChecking no" root@school-server "
          docker compose pull
          docker compose up --build -d
        "